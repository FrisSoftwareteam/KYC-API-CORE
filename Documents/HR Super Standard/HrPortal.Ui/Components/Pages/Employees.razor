@page "/employees"
@inject HttpClient Http

<PageTitle>Employees</PageTitle>

<h3>Employees</h3>
<div class="filters">
    <input placeholder="Search by name" @bind="query" @bind:event="oninput" />
    <button class="cta" @onclick="Load">Search</button>
</div>

<table>
    <thead><tr><th>Name</th><th>Dept</th><th>Title</th><th>Status</th></tr></thead>
    <tbody>
        @if (employees.Count == 0)
        {
            <tr><td colspan="4">No results</td></tr>
        }
        else
        {
            foreach (var e in employees)
            {
                <tr>
                    <td>@($"{e.FirstName} {e.LastName}")</td>
                    <td>@e.Dept</td>
                    <td>@e.Title</td>
                    <td>@e.Status</td>
                </tr>
            }
        }
    </tbody>
</table>

@code {
    private List<EmployeeDto> employees = new();
    private string query = string.Empty;

    protected override async Task OnInitializedAsync() => await Load();

    private async Task Load()
    {
        var url = "employees";
        if (!string.IsNullOrWhiteSpace(query))
        {
            url += $"?q={Uri.EscapeDataString(query)}";
        }

        employees = await Http.GetFromJsonAsync<List<EmployeeDto>>(url) ?? new();
    }

    public record EmployeeDto(int Id, string FirstName, string LastName, string Dept, string Title, string Status);
}
