@page "/"
@inject HttpClient Http

<PageTitle>Dashboard</PageTitle>

<div class="hero">
    <div class="hero-left">
        <div class="hero-title">Online Access to Share Account</div>
        <div class="hero-sub">First Registrars &amp; Investor Services</div>
        <button class="cta">Access Portal</button>
    </div>
    <div class="hero-image"></div>
</div>

<div class="split">
    <div class="card birthdays">
        <div class="card-title">Birthday Celebrant(s) For This Month</div>
        <table>
            <thead><tr><th>#</th><th>Name</th><th>Date</th></tr></thead>
            <tbody>
                @if (birthdays.Count == 0)
                {
                    <tr><td colspan="3">No birthdays</td></tr>
                }
                else
                {
                    var i = 1;
                    foreach (var b in birthdays)
                    {
                        <tr>
                            <td>@i</td>
                            <td>@b.Name</td>
                            <td>@($"{b.Day}/{b.Month}")</td>
                        </tr>
                        i++;
                    }
                }
            </tbody>
        </table>
    </div>
    <div class="card announcements">
        <div class="card-title">Announcements</div>
        @if (announcements.Count == 0)
        {
            <div class="muted">No active announcements</div>
        }
        else
        {
            foreach (var a in announcements)
            {
                <div class="ann">
                    <div class="ann-title">@a.Title</div>
                    <div class="ann-body">@a.Body</div>
                </div>
            }
        }
    </div>
</div>

<div class="services-section">
    <h3>Our Services</h3>
    <div class="services">
        <ul>
            <li>Client companies register of shareholders updates</li>
            <li>Payment of dividend warrants/interest to shareholders</li>
            <li>Registration of share transfers and name changes</li>
            <li>Probate/Letters of administration handling</li>
        </ul>
        <div class="services-image"></div>
    </div>
</div>

<div class="vision">
    <div>
        <h4>Vision Statement</h4>
        <p>To be the clear leader in the provision of share registration and other investor services in Africa.</p>
    </div>
    <div>
        <h4>Mission Statement</h4>
        <p>Deliver secure, efficient, and customer-focused registry services that empower investors and issuers.</p>
    </div>
</div>

@code {
    private List<BirthdayDto> birthdays = new();
    private List<AnnouncementDto> announcements = new();

    protected override async Task OnInitializedAsync()
    {
        try
        {
            birthdays = await Http.GetFromJsonAsync<List<BirthdayDto>>("employees/birthdays?month=" + DateTime.UtcNow.Month) ?? new();
            announcements = await Http.GetFromJsonAsync<List<AnnouncementDto>>("announcements/active") ?? new();
        }
        catch
        {
            birthdays = new();
            announcements = new();
        }
    }

    public record BirthdayDto(int Id, string Name, int Day, int Month);
    public record AnnouncementDto(int Id, string Title, string Body, string Category, DateTime StartAt, DateTime EndAt);
}
